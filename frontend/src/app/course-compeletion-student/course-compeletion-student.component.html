<div class="course-player" *ngIf="currentCourse && !loading">
  <div class="course-header">
    <div class="goBack" (click)="goBack()">
      <h3>Назад</h3>
    </div>
    <div class="course-header-content">
      <h1>{{ currentCourse.title }}</h1>
      <p>{{ currentCourse.description }}</p>
      
      <!-- Прогресс курса -->
      <div class="course-progress" *ngIf="courseProgress">
        <div class="progress-bar">
          <div class="progress-completed" [style.width.%]="progressPercentage"></div>
        </div>
        <div class="progress-text">
          Пройдено: {{ courseProgress.completedLessons }} из {{ courseProgress.totalLessons }} уроков ({{ progressPercentage }}%)
        </div>
      </div>
    </div>
  </div>

  <div class="course-content">
    <!-- Боковая панель с модулями и уроками -->
    <div class="sidebar">
      <div
        *ngFor="let module of currentCourse.modules; let moduleIndex = index"
        class="module"
      >
        <h4 (click)="navigateToLesson(moduleIndex, 0)">{{ module.title }}</h4>
        <ul>
          <li
            *ngFor="let lesson of module.lessons; let lessonIndex = index"
            [class.active]="
              moduleIndex === currentModuleIndex &&
              lessonIndex === currentLessonIndex
            "
            [class.completed]="isLessonCompleted(module.id, lesson.id)"
            (click)="navigateToLesson(moduleIndex, lessonIndex)"
          >
            {{ lesson.title }}
            
          </li>
        </ul>
      </div>
    </div>

    <!-- Основной контент урока -->
    <div class="lesson-view">
      <div *ngIf="getCurrentLesson() as lesson; else noLesson">
        <h2>{{ lesson.title }}</h2>
        <p>{{ lesson.description }}</p>

        <!-- Контент урока -->
        <div *ngIf="lesson.content_url" class="lesson-media">
          <!-- Для YouTube -->
          <iframe
            *ngIf="isYoutubeUrl(lesson.content_url)"
            [src]="getSafeYoutubeUrl(lesson.content_url)"
            width="100%"
            height="500"
            frameborder="0"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
          >
          </iframe>

          <!-- Для обычных видео -->
          <video
            *ngIf="lesson.type === 'video' && !isYoutubeUrl(lesson.content_url)"
            [src]="lesson.content_url"
            controls
            width="100%"
          ></video>

          <!-- Для PDF -->
          <iframe
            *ngIf="lesson.type === 'pdf'"
            [src]="lesson.content_url"
            width="100%"
            height="500px"
          >
          </iframe>
        </div>

        <!-- Кнопки навигации -->
        <div class="navigation-buttons">
          <button
            *ngIf="!isLessonCompleted(currentCourse.modules[currentModuleIndex].id, lesson.id)"
            (click)="completeLesson(currentCourse.modules[currentModuleIndex].id, lesson.id)"
            class="complete-lesson-btn"
          >
            Завершить урок
          </button>
          <button 
            *ngIf="!(currentModuleIndex === currentCourse.modules.length - 1 && currentLessonIndex === currentCourse.modules[currentModuleIndex].lessons.length - 1)"
            (click)="nextLesson()"
            class="next-lesson-btn"
          >
            Следующий урок
          </button>
          <button
            *ngIf="isCourseCompleted"
            class="get-certificate-btn"
            (click)="getCertificate()"
          >
            Получить сертификат
          </button>
        </div>

      </div>

      <ng-template #noLesson>
        <p>Урок не найден.</p>
      </ng-template>
    </div>
  </div>
</div>

<div *ngIf="loading" class="loading-indicator">
  Загрузка данных курса...
</div>